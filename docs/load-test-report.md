# 부하 테스트 결과 보고서

## 1. 테스트 개요

| 항목 | 내용 |
|------|------|
| 환경 | API 4GB RAM, 인프라 8GB RAM (Docker) |
| 기준 | DAU 500명 |
| 도구 | k6 + InfluxDB + Grafana |

---

## 2. 시나리오 1: 인기 상품 조회 Peak Test

### 목표
- VU: 60명 → 300명 (피크)
- 응답시간: p95 < 500ms, p99 < 1000ms
- 에러율: < 5%

### 결과

| 지표 | 목표 | 실제 | 달성 |
|------|------|------|------|
| p95 응답시간 | < 500ms | 48.23ms | ✅ |
| p99 응답시간 | < 1000ms | 155.07ms | ✅ |
| 평균 응답시간 | - | 17.19ms | ✅ |
| 최대 응답시간 | - | 1.12s | ⚠️ |
| 에러율 | < 5% | 0.01% (6/58,435) | ✅ |
| RPS | - | 129.58 req/s | - |
| 총 요청 | - | 58,435개 | - |
| 성공률 | - | 99.99% | ✅ |

### 성능 분석

**✅ 우수한 점**
- p95/p99 응답시간 목표 대비 **10배 이상 여유** (p95: 48ms vs 목표 500ms)
- 평균 응답시간 17ms로 **매우 빠른 응답**
- 에러율 0.01%로 **높은 안정성**
- 300 VU 피크 부하에서도 안정적 처리

**⚠️ 발견된 이슈**
1. **타임아웃 발생**: 6건의 요청 실패 (i/o timeout)
   - 최대 응답시간 1.12초 발생
   - 2분 30초~5분 50초 구간에서 산발적 발생
   - VU 증가 구간(60→300)과 고부하 유지 구간에서 발생

2. **응답시간 편차**: 평균 17ms vs 최대 1.12s
   - 대부분 요청은 빠르나 일부 느린 요청 존재
   - p99(155ms) 대비 최대값이 7배 이상 차이

---

## 3. 병목 분석

### 추정 원인

1. **DB 커넥션 풀 부족**
   - 순간적 부하 증가 시 커넥션 대기 발생 가능
   - 현재 설정 확인 필요 (HikariCP 기본값: 10개)

2. **Redis 캐시 미스 시 DB 부하**
   - 캐시 미스 시 복잡한 집계 쿼리(최근 3일 판매량 top5) 실행
   - 동시 캐시 미스 발생 시 DB 부하 집중

3. **GC(Garbage Collection) 일시 정지**
   - JVM Heap 부족 시 Full GC로 인한 일시 정지 가능성

4. **네트워크 지연**
   - Docker 네트워크(host.docker.internal) 간헐적 지연

---

## 4. 개선 방안

| 우선순위 | 개선 항목 | 예상 효과 | 구현 난이도 |
|---------|----------|----------|-----------|
| **높음** | DB 커넥션 풀 증설 (10→30) | 타임아웃 제거, 동시성 향상 | 낮음 |
| **높음** | Redis 캐시 TTL 최적화 | 캐시 히트율 향상, DB 부하 감소 | 낮음 |
| **중간** | 인기 상품 쿼리 인덱스 최적화 | 캐시 미스 시 응답시간 단축 | 중간 |
| **중간** | Connection timeout 설정 완화 (60s 검토) | 순간 부하 시 안정성 향상 | 낮음 |
| **낮음** | JVM Heap 크기 조정 (현재 설정 확인) | GC 빈도 감소 | 낮음 |
| **낮음** | API 응답 캐싱 레이어 추가 (CDN 등) | 서버 부하 분산 | 높음 |

### 즉시 적용 가능한 조치

```yaml
# application.yml
spring:
  datasource:
    hikari:
      maximum-pool-size: 30  # 기존 10 → 30
      connection-timeout: 30000  # 30초

  data:
    redis:
      timeout: 3000ms  # 타임아웃 명시
```

```java
// 인기 상품 캐시 TTL 설정
@Cacheable(value = "popularProducts", key = "#type + ':' + #days",
           cacheManager = "redisCacheManager")
// TTL: 10분 → 5분으로 단축 (최신성 vs 성능 균형)
```

---

## 5. 종합 평가

### 전체 목표 달성률
- **100% 달성** (4개 중 4개 목표 달성)
- 피크 부하(300 VU) 처리 성공
- 응답시간 및 에러율 목표 충족